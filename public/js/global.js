//var _0xede9=["\x23\x66\x61\x63\x74\x75\x72\x61\x2C\x20\x23\x6E\x6F\x5F\x61\x70\x72\x6F\x62\x61\x64\x6F\x73\x2C\x20\x23\x61\x70\x72\x6F\x62\x61\x64\x6F\x73","\x63\x6F\x6E\x74\x65\x6E\x74","\x61\x74\x74\x72","\x6D\x65\x74\x61\x5B\x6E\x61\x6D\x65\x3D\x22\x63\x73\x72\x66\x2D\x74\x6F\x6B\x65\x6E\x22\x5D","\x61\x6A\x61\x78\x53\x65\x74\x75\x70","\x70\x72\x65\x76\x65\x6E\x74\x44\x65\x66\x61\x75\x6C\x74","\x66\x61\x63\x74\x75\x72\x61\x2D\x78\x6D\x6C","\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64","\x66\x69\x6C\x65\x73","\x61\x70\x70\x65\x6E\x64","\x2F\x76\x61\x6C\x69\x64\x61\x63\x69\x6F\x6E","\x50\x4F\x53\x54","\x6A\x73\x6F\x6E","\x6D\x75\x6C\x74\x69\x70\x61\x72\x74\x2F\x66\x6F\x72\x6D\x2D\x64\x61\x74\x61","\x66\x61\x63\x74\x75\x72\x61","\x73\x75\x63\x63\x65\x73\x73","\x3C\x74\x72\x3E\x0D\x09\x09\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x74\x64\x3E","\x66\x6F\x6C\x69\x6F","\x3C\x2F\x74\x64\x3E\x0D\x09\x09\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x74\x64\x3E\x24\x20","\x74\x6F\x74\x61\x6C","\x3C\x2F\x74\x64\x3E\x0D\x09\x09\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x74\x64\x3E\x20\x33\x3C\x2F\x74\x64\x3E\x0D\x09\x09\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x74\x64\x3E\x3C\x62\x75\x74\x74\x6F\x6E\x20\x63\x6C\x61\x73\x73\x3D\x22\x62\x74\x6E\x20\x62\x74\x6E\x2D\x70\x72\x69\x6D\x61\x72\x79\x22\x20\x73\x74\x79\x6C\x65\x3D\x22\x77\x69\x64\x74\x68\x3A\x20\x33\x30\x25\x3B\x20\x62\x61\x63\x6B\x67\x72\x6F\x75\x6E\x64\x3A\x20\x23\x32\x61\x39\x31\x64\x36\x3B\x22\x20\x68\x72\x65\x66\x3D\x22\x22\x3E\x76\x65\x72\x3C\x2F\x62\x75\x74\x74\x6F\x6E\x3E\x20","\x66\x65\x63\x68\x61","\x3C\x2F\x74\x64\x3E\x0D\x09\x09\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x2F\x74\x72\x3E","\x61\x66\x74\x65\x72","\x23\x66\x61\x63\x74\x75\x72\x61\x20\x74\x72\x3A\x6C\x61\x73\x74","","\x68\x74\x6D\x6C","\x23\x65\x72\x72\x6F\x72\x65\x73","\x78\x6D\x6C\x5F\x69\x6E\x66\x6F","\x3C\x74\x72\x3E\x0D\x09\x09\x09\x09\x09\x09\x09\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x74\x64\x3E","\x6E\x6F\x5F\x69\x64\x65\x6E\x74\x69\x66\x69\x63\x61\x63\x69\x6F\x6E","\x3C\x2F\x74\x64\x3E\x0D\x09\x09\x09\x09\x09\x09\x09\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x74\x64\x3E","\x69\x64\x5F\x66\x61\x63\x74\x75\x72\x61","\x75\x6E\x69\x64\x61\x64","\x64\x65\x73\x63\x72\x69\x70\x63\x69\x6F\x6E","\x63\x61\x6E\x74\x69\x64\x61\x64","\x3C\x2F\x74\x64\x3E\x0D\x09\x09\x09\x09\x09\x09\x09\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x74\x64\x3E\x24\x20","\x69\x6D\x70\x6F\x72\x74\x65","\x3C\x2F\x74\x64\x3E\x0D\x09\x09\x09\x09\x09\x09\x09\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x2F\x74\x72\x3E","\x23\x61\x70\x72\x6F\x62\x61\x64\x6F\x73\x20\x74\x72\x3A\x6C\x61\x73\x74","\x23\x6E\x6F\x5F\x61\x70\x72\x6F\x62\x61\x64\x6F\x73\x20\x74\x72\x3A\x6C\x61\x73\x74","\x65\x72\x72\x6F\x72\x73","\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x22\x61\x6C\x65\x72\x74\x20\x61\x6C\x65\x72\x74\x2D\x64\x61\x6E\x67\x65\x72\x22\x3E","\x3C\x2F\x64\x69\x76\x3E","\x65\x61\x63\x68","\x69\x6E\x76\x61\x6C\x69\x64\x61","\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x22\x61\x6C\x65\x72\x74\x20\x61\x6C\x65\x72\x74\x2D\x64\x61\x6E\x67\x65\x72\x22\x3E\x58\x4D\x4C\x20\x49\x4E\x56\x41\x4C\x49\x44\x4F\x3C\x2F\x64\x69\x76\x3E","\x61\x6A\x61\x78","\x73\x75\x62\x6D\x69\x74","\x23\x66\x6F\x72\x6D\x2D\x61\x64\x64","\x72\x65\x61\x64\x79"];$(document)[_0xede9[50]](function(){$(_0xede9[0]).DataTable();$[_0xede9[4]]({headers:{"\x58\x2D\x43\x53\x52\x46\x2D\x54\x4F\x4B\x45\x4E":$(_0xede9[3])[_0xede9[2]](_0xede9[1])}});$(_0xede9[49])[_0xede9[48]](function(_0xcabax1){_0xcabax1[_0xede9[5]]();var _0xcabax2=document[_0xede9[7]](_0xede9[6]);var _0xcabax3=_0xcabax2[_0xede9[8]][0];var _0xcabax4= new FormData();_0xcabax4[_0xede9[9]](_0xede9[6],_0xcabax3);$[_0xede9[47]]({url:_0xede9[10],type:_0xede9[11],dataType:_0xede9[12],data:_0xcabax4,enctype:_0xede9[13],cache:false,contentType:false,processData:false,success:function(_0xcabax5){if(_0xcabax5[_0xede9[14]]!= null&& _0xcabax5[_0xede9[15]]== true){var _0xcabax6=_0xede9[16]+ _0xcabax5[_0xede9[14]][0][_0xede9[17]]+ _0xede9[18]+ _0xcabax5[_0xede9[14]][0][_0xede9[19]]+ _0xede9[20]+ _0xcabax5[_0xede9[14]][0][_0xede9[21]]+ _0xede9[22];$(_0xede9[24])[_0xede9[23]](_0xcabax6);$(_0xede9[27])[_0xede9[26]](_0xede9[25]);for(var _0xcabax7 in _0xcabax5[_0xede9[28]]){var _0xcabax8=_0xede9[29]+ _0xcabax5[_0xede9[28]][_0xcabax7][_0xede9[30]]+ _0xede9[31]+ _0xcabax5[_0xede9[28]][_0xcabax7][_0xede9[32]]+ _0xede9[31]+ _0xcabax5[_0xede9[28]][_0xcabax7][_0xede9[33]]+ _0xede9[31]+ _0xcabax5[_0xede9[28]][_0xcabax7][_0xede9[34]]+ _0xede9[31]+ _0xcabax5[_0xede9[28]][_0xcabax7][_0xede9[35]]+ _0xede9[36]+ _0xcabax5[_0xede9[28]][_0xcabax7][_0xede9[37]]+ _0xede9[38];$(_0xede9[39])[_0xede9[23]](_0xcabax8);$(_0xede9[40])[_0xede9[23]](_0xcabax8)}};if(_0xcabax5[_0xede9[15]]== false){$[_0xede9[44]](_0xcabax5[_0xede9[41]],function(_0xcabax9,_0xcabaxa){$(_0xede9[27])[_0xede9[26]](_0xede9[42]+ _0xcabaxa+ _0xede9[43])})};if(_0xcabax5[_0xede9[15]]== _0xede9[45]){$(_0xede9[27])[_0xede9[26]](_0xede9[42]+ _0xcabax5[_0xede9[41]]+ _0xede9[43])}},statusCode:{500:function(){$(_0xede9[27])[_0xede9[26]](_0xede9[46])}}})})})
$(document).ready(function() {
  $('input[name="daterange"]').daterangepicker({
    opens: 'left'
	  	}, function(start, end, label) {
	    	console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
  });
 
 	  $('#a_validar').dataTable();
   	  //$('#factura, #no_aprobados, #aprobado, #pendientes, #a_validar').DataTable();
      $('.table-factura, .table-no-aprobados, .table-aprobados, .table-pendientes').DataTable({
        dom: 'lBfrtip',
        "iDisplayLength": 5,
        "aLengthMenu": [[5, 10, 25, 50, 100], [5, 10, 25, 50,100, "All"]],
         buttons: [
            {
                extend:    'copyHtml5',
               // text:      '<i class="fa fa-files-o"></i>',
                text:      'COPIAR',
                titleAttr: 'Copy'
            },
            {
                extend:    'excelHtml5',
                //text:      '<i class="fa fa-file-excel-o"></i>',
                text:      'EXCEL',
                titleAttr: 'Excel'
            },
            {
                extend:    'csvHtml5',
                //text:      '<i class="fa fa-file-text-o"></i>',
                text:      'CSV',
                titleAttr: 'CSV'
            },
            {
                extend:    'pdfHtml5',
                //text:      '<i class="fa fa-file-pdf-o"></i>',
                text:      'PDF',
                titleAttr: 'PDF'
            }
        ]
    });

   /*$('#a_validar').DataTable( {
        dom: 'lBfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ]
    } );*/


	
	$.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
	});

 $('#form-add').submit(function(e){
 		e.preventDefault();
		var inputFileImage = document.getElementById("factura-xml");
		var file = inputFileImage.files[0];
		var data = new FormData();
		data.append("factura-xml",file);

 	$.ajax({
//		url: window.location.protocol+'//'+window.location.host+'/pisaftp/public/validacion',
			url: '/public/validacion',
			type: 'POST',
			dataType: 'json',
			data:data,
			enctype: 'multipart/form-data',
			cache: false,
		    contentType: false,
		    processData: false,
		    success: function(respuesta){	
		    	//console.log(respuesta.xml_info[0]['no_identificacion']);
		    	/*for (var i in respuesta.xml_info) {
				     console.log( i + " = " + respuesta.xml_info[i]['no_identificacion']  + "\n");
				     console.log( i + " = " + respuesta.xml_info[i]['unidad']  + "\n");
				     console.log( i + " = " + respuesta.xml_info[i]['descripcion']  + "\n");
				     console.log( i + " = " + respuesta.xml_info[i]['cantidad']  + "\n"); 
				     console.log( i + " = " + respuesta.xml_info[i]['importe']  + "\n");
			    }*/
			    
		    	if(respuesta.factura != null && respuesta.success == true){
					var row = '<tr>\
		                <td>' + respuesta.factura[0]['folio']  + '</td>\
		                <td>$ ' + respuesta.factura[0]['total']  + '</td>\
		                <td> 3</td>\
		                <td><button class="btn btn-primary" style="width: 30%; background: #2a91d6;" href="">ver</button> ' + respuesta.factura[0]['fecha']  + '</td>\
		             </tr>';

	 				$('#factura tr:last').after(row);
	 				$('#errores').html('');

					//Se agregan los registros en la tabla de productos.
						for (var i in respuesta.xml_info) {
							var inv = '<tr>\
							                <td>' + respuesta.xml_info[i]['no_identificacion']  + '</td>\
							                <td>' + respuesta.xml_info[i]['id_factura'] + '</td>\
							                <td>' + respuesta.xml_info[i]['unidad']  + '</td>\
							                <td>' + respuesta.xml_info[i]['descripcion']  + '</td>\
							                <td>' + respuesta.xml_info[i]['cantidad']  + '</td>\
							                <td>$ ' + respuesta.xml_info[i]['importe']  + '</td>\
							           </tr>';

							    $('#pendientes tr:last').after(inv); 
						}
 				}

 				if(respuesta.success == false){
 					$.each( respuesta.errors, function( key, value ) {
						$('#errores').html('<div class="alert alert-danger">'+ value +'</div>'); 
					});
 				}

 				if(respuesta.success == 'invalida'){
 					$('#errores').html('<div class="alert alert-danger">'+ respuesta.errors +'</div>'); 
 				}

			},
			statusCode: {
			    500: function() {
			      $('#errores').html('<div class="alert alert-danger">XML INVALIDO</div>'); 
			    }
			  }
		});
	});	


$('#rfc').change(function(){
	var id = $(this).val();
		$.ajax({
			//url: window.location.protocol+'//'+window.location.host+'/pisaftp/public/filtro-rfc',
			url: '/public/filtro-rfc',
			type: 'POST',
			dataType: 'json',
			data: {'id' : id},
		    success: function(respuesta){

		    	$('.factura').html('');
		    	$('.aprobados, .pendientes, .no_aprobados').html('');
		    	//$('#factura, #no_aprobados, #aprobados, #pendientes, #a_validar').DataTable();

			   	if(respuesta.facturas != null){
			   		console.log( respuesta.facturas );
					for (var j in respuesta.facturas) {
						var row = '<tr class="factura">\
					                <td>' + respuesta.facturas[j]['folio']  + '</td>\
					                <td>$ ' + respuesta.facturas[j]['total']  + '</td>\
					                <td> 3</td>\
					                <td><a class="btn btn-primary" style="width: 30%; background: #2a91d6;" href="{{App::make("url")->to('/')}}/factura_info/{{ respuesta.facturas[j]["id"] }}">ver</a> ' + respuesta.facturas[j]['fecha']  + '</td>\
					             </tr>';
					             $('#factura tr:last').after(row);
					}
				}

				if(respuesta.productos != null){
					//Se agregan los registros en la tabla de productos con estatus APROBADO.
					for (var i in respuesta.productos) {
						if( respuesta.productos[i]['estatus'] == 'APROBADO' ){
							// $('#aprobados').DataTable();
							var inv = '<tr class="aprobados">\
							                <td>' + respuesta.productos[i]['no_identificacion']  + '</td>\
							                <td>' + respuesta.productos[i]['id_factura'] + '</td>\
							                <td>' + respuesta.productos[i]['unidad']  + '</td>\
							                <td>' + respuesta.productos[i]['descripcion']  + '</td>\
							                <td>' + respuesta.productos[i]['cantidad']  + '</td>\
							                <td>$ ' + respuesta.productos[i]['importe']  + '</td>\
							           </tr>';
							    $('#aprobados tr:last').after(inv); 
						}
					}
					//Se agregan los registros en la tabla de productos con estatus PENDIENTES.
					for (var i in respuesta.productos) {
						if( respuesta.productos[i]['estatus'] == 'PENDIENTE' ){
							var inv = '<tr class="pendientes">\
							                <td>' + respuesta.productos[i]['no_identificacion']  + '</td>\
							                <td>' + respuesta.productos[i]['id_factura'] + '</td>\
							                <td>' + respuesta.productos[i]['unidad']  + '</td>\
							                <td>' + respuesta.productos[i]['descripcion']  + '</td>\
							                <td>' + respuesta.productos[i]['cantidad']  + '</td>\
							                <td>$ ' + respuesta.productos[i]['importe']  + '</td>\
							           </tr>';
							    $('#pendientes tr:last').after(inv); 
						}
					}
					//Se agregan los registros en la tabla de productos.
					for (var i in respuesta.productos) {
						if( respuesta.productos[i]['estatus'] == 'NO APROBADO' ){
							var inv = '<tr class="no_aprobados">\
							                <td>' + respuesta.productos[i]['no_identificacion']  + '</td>\
							                <td>' + respuesta.productos[i]['id_factura'] + '</td>\
							                <td>' + respuesta.productos[i]['unidad']  + '</td>\
							                <td>' + respuesta.productos[i]['descripcion']  + '</td>\
							                <td>' + respuesta.productos[i]['cantidad']  + '</td>\
							                <td>$ ' + respuesta.productos[i]['importe']  + '</td>\
							                <td><a class="btn btn-primary" style="background: #2a91d6;" href="">Enviar e-mail</a></td>\
							           </tr>';
							    $('#no_aprobados tr:last').after(inv); 
						}
					}
	 			}
		    }
		});

	});



	$('table .validar-producto').click(function(){
		var id = $(this).attr('data-id');
		var estatus = $(this).val();

			data = { 
				'id' : id,
				'estatus' : estatus 
			};
			
				$.ajax({
					//url: window.location.protocol+'//'+window.location.host+'/pisaftp/public/validacion-producto',
					url: '/public/validacion-producto',
					type: 'POST',
					dataType: 'json',
					data: data,
				    success: function(respuesta){

				    	console.log(respuesta);
				    	/*if(respuesta.success){
							location.reload();
						    $('#mensaje').html('<div class="alert alert-success">'+ respuesta.message +'</div>');
				    	}*/
				    } 
				   
				});

		//aceptar_validacion(id);
		//$('#aceptar_validacion').attr('data-dismiss', "modal");

	});


});


/*function aceptar_validacion(id){

$('#identificador').val(id);

//$('#aceptar_validacion').click(function(){
	 $(".aceptar_validacion").on('click', function() {

//$('#estat"usModal').modal('hide');
				var estatus = $('#estatus').val();
				var id = $('#identificador').val();

				data = { 
					'id' : id,
					'estatus' : estatus 
				};

//alert( window.location.protocol+'//'+window.location.host+'/pisaftp/public/validacion-producto' );
					$.ajax({
						//url: window.location.protocol+'//'+window.location.host+'/pisaftp/public/validacion-producto',
						url: '/public/validacion-producto',
						type: 'POST',
						dataType: 'json',
						data: data,
					    success: function(respuesta){

					    	console.log(respuesta);
					    	 if(respuesta.success){
								location.reload();
							    $('#mensaje').html('<div class="alert alert-success">'+ respuesta.message +'</div>');
					    	} 
					    }
					});
			});
}*/


function send_mail(){

	alert("Mail enviado correctamente");

}


$('#factura-xml').change(function(e) {
    // Obtenemos la ruta temporal mediante el evento
    var TmpPath = e.target.files[0]['name'];
    // Mostramos la ruta temporal
    $('#path').html(TmpPath);
});



/*$('.imprimir_reporte').click(function(){
 		//e.preventDefault();

		var fecha = $('#daterange').val();
		var estatus = $('#estatus_reporte').val();

		data = {
			'fecha' : fecha,
			'estatus' : estatus
		};
		//$(this).attr('href', $(this).attr('href')+'?estatus='+estatus+'&id='+id);
			$.ajax({
					url: '/public/imprimir-reporte',
					global: false,
					type: 'POST',
					dataType: 'json',
					data: data,
		    }).done(function (data, textStatus, jqXHR) {


                var nombreLogico = "PISA_REPORTE";

                //alert( "'data:application/pdf," + escape(data) + "'" );
                var parametros = "dependent=yes,locationbar=no,scrollbars=yes,menubar=yes,resizable,screenX=50,screenY=50,width=850,height=1050";
                var htmlText = "<embed width=100% height=100% type='application/pdf' http-equiv='Content-Type' content='text/html; charset=utf-8'src='data:application/pdf," + escape(data) + "'></embed>";
				var detailWindow = window.open("", nombreLogico, parametros);
                //var detailWindow = window.open();
                detailWindow.document.write(htmlText);
                detailWindow.document.close();
	        }).fail(function (jqXHR, textStatus, errorThrown) {
	            alert("error\njqXHR=" + jqXHR + "\nstatus=" + textStatus + "\nerror=" + errorThrown);
	        }).always(function(dataORjqXHR, textStatus, jqXHR_ORerrorThrown) {
	            //alert( "complete" );
	        });
		
			
});*/


/*function show_invoice(id){
	alert(id);

		$.ajax({
			url: '/factura-info',
			type: 'POST',
			dataType: 'json',
			data: {'id' : id},
		    success: function(respuesta){

		    	redirect 
		    	console.log(respuesta);
		    }
		});



}*/
